<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Lint - McCole Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">McCole Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">McCole</a>
                            </li>
                            <li class="nav-item">
                                <a href="../CODE_OF_CONDUCT/" class="nav-link">Code of Conduct</a>
                            </li>
                            <li class="nav-item">
                                <a href="../CONTRIBUTING/" class="nav-link">Contributing</a>
                            </li>
                            <li class="nav-item">
                                <a href="../LICENSE/" class="nav-link">MIT License</a>
                            </li>
                            <li class="nav-item">
                                <a href="../build/" class="nav-link">Build</a>
                            </li>
                            <li class="nav-item">
                                <a href="../install/" class="nav-link">Install</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Lint</a>
                            </li>
                            <li class="nav-item">
                                <a href="../refresh/" class="nav-link">Refresh</a>
                            </li>
                            <li class="nav-item">
                                <a href="../stats/" class="nav-link">Stats</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                            <li class="nav-item">
                                <a rel="prev" href="../install/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../refresh/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint" class="nav-link">lint</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint.lint" class="nav-link">lint</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint.check_file_references" class="nav-link">check_file_references</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint.lint_bibliography_references" class="nav-link">lint_bibliography_references</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint.lint_figure_numbers" class="nav-link">lint_figure_numbers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint.lint_figure_references" class="nav-link">lint_figure_references</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint.lint_glossary_redefinitions" class="nav-link">lint_glossary_redefinitions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint.lint_glossary_references" class="nav-link">lint_glossary_references</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint.lint_link_references" class="nav-link">lint_link_references</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint.lint_table_references" class="nav-link">lint_table_references</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint.parse_args" class="nav-link">parse_args</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint._check_object_refs" class="nav-link">_check_object_refs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint._check_references" class="nav-link">_check_references</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint._is_missing" class="nav-link">_is_missing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint._is_special_link" class="nav-link">_is_special_link</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint._report_diff" class="nav-link">_report_diff</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#mccole.lint._resolve_path" class="nav-link">_resolve_path</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<div class="doc doc-object doc-module">



<a id="mccole.lint"></a>
    <div class="doc doc-contents first">

        <p>Check site consistency.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="mccole.lint.lint" class="doc doc-heading">
            <code class="highlight language-python">lint(opt)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Main driver.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def lint(opt):
    """Main driver."""
    config = load_config(opt.config)
    skips = config["skips"] | {opt.out}
    files = find_files(opt, skips)
    check_file_references(files)

    files = {path: data for path, data in files.items() if path.suffix == ".md"}
    extras = {
        "bibliography": find_key_defs(files, "bibliography"),
        "glossary": find_key_defs(files, "glossary"),
    }

    linters = [
        lint_bibliography_references,
        lint_figure_numbers,
        lint_figure_references,
        lint_glossary_redefinitions,
        lint_glossary_references,
        lint_link_references,
        lint_table_references,
    ]
    sections = {path: data["content"] for path, data in files.items()}
    if all(list(f(opt, config, sections, extras) for f in linters)):
        print("All self-checks passed.")</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint.check_file_references" class="doc doc-heading">
            <code class="highlight language-python">check_file_references(files)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Check inter-file references.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def check_file_references(files):
    """Check inter-file references."""
    ok = True
    for path, data in files.items():
        content = data["content"]
        if path.suffix != ".md":
            continue
        for link in MD_FILE_LINK.finditer(content):
            if _is_special_link(link.group(2)):
                continue
            target = _resolve_path(path.parent, link.group(2))
            if _is_missing(target, files):
                print(f"Missing file: {path} =&gt; {target}")
                ok = False
    return ok</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint.lint_bibliography_references" class="doc doc-heading">
            <code class="highlight language-python">lint_bibliography_references(opt, config, sections, extras)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Check bibliography references.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def lint_bibliography_references(opt, config, sections, extras):
    """Check bibliography references."""
    available = set(extras["bibliography"].keys())
    if available is None:
        print("No bibliography found (or multiple matches)")
        return False
    return _check_references(sections, "bibliography", BIB_REF, available)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint.lint_figure_numbers" class="doc doc-heading">
            <code class="highlight language-python">lint_figure_numbers(opt, config, sections, extras)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Check figure numbering.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def lint_figure_numbers(opt, config, sections, extras):
    """Check figure numbering."""
    ok = True
    for path, content in sections.items():
        current = 1
        for caption in FIGURE_CAPTION.finditer(content):
            text = caption.group(1)
            if ("Figure" not in text) or (":" not in text):
                print(f"Bad caption: {path} / '{text}'")
                ok = False
                continue
            fields = text.split(":")
            if len(fields) != 2:
                print(f"Bad caption: {path} / '{text}'")
                ok = False
                continue
            fields = fields[0].split(" ")
            if len(fields) != 2:
                print(f"Bad caption: {path} / '{text}'")
                ok = False
                continue
            try:
                number = int(fields[1])
                if number != current:
                    print(f"Caption number out of sequence: {path} / '{text}'")
                    ok = False
                else:
                    current += 1
            except ValueError:
                print(f"Bad caption number: {path} / '{text}'")
                ok = False
    return ok</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint.lint_figure_references" class="doc doc-heading">
            <code class="highlight language-python">lint_figure_references(opt, config, sections, extras)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Check figure references.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def lint_figure_references(opt, config, sections, extras):
    """Check figure references."""
    return _check_object_refs(sections, "figure", FIGURE_DEF, FIGURE_REF)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint.lint_glossary_redefinitions" class="doc doc-heading">
            <code class="highlight language-python">lint_glossary_redefinitions(opt, config, sections, extras)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Check glossary redefinitions.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def lint_glossary_redefinitions(opt, config, sections, extras):
    """Check glossary redefinitions."""
    found = defaultdict(set)
    for path, content in sections.items():
        if "glossary" in str(path).lower():
            continue
        for m in GLOSS_REF.finditer(content):
            found[m[1]].add(str(path))

    problems = {k:v for k, v in found.items() if len(v) &gt; 1}
    for k, v in problems.items():
        if len(v) &gt; 1:
            print(f"glossary key {k} redefined: {', '.join(sorted(v))}")
    return len(problems) == 0</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint.lint_glossary_references" class="doc doc-heading">
            <code class="highlight language-python">lint_glossary_references(opt, config, sections, extras)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Check glossary references.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def lint_glossary_references(opt, config, sections, extras):
    """Check glossary references."""
    available = set(extras["glossary"].keys())
    if available is None:
        print("No glossary found (or multiple matches)")
        return False
    return _check_references(sections, "glossary", GLOSS_REF, available)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint.lint_link_references" class="doc doc-heading">
            <code class="highlight language-python">lint_link_references(opt, config, sections, extras)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Check that Markdown files use links that have been defined.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def lint_link_references(opt, config, sections, extras):
    """Check that Markdown files use links that have been defined."""
    if not config["links"]:
        return True
    links = set(config["links"].keys())
    link_refs = set()
    for path, content in sections.items():
        link_refs |= {m[1] for m in MD_LINK_REF.findall(content)}
    return _report_diff("links used", link_refs, links)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint.lint_table_references" class="doc doc-heading">
            <code class="highlight language-python">lint_table_references(opt, config, sections, extras)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Check figure references.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def lint_table_references(opt, config, sections, extras):
    """Check figure references."""
    return _check_object_refs(sections, "table", TABLE_DEF, TABLE_REF)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint.parse_args" class="doc doc-heading">
            <code class="highlight language-python">parse_args(parser)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Parse command-line arguments.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def parse_args(parser):
    """Parse command-line arguments."""
    parser.add_argument("--config", type=str, default="pyproject.toml", help="optional configuration file")
    parser.add_argument("--out", type=str, default="docs", help="output directory")
    parser.add_argument("--root", type=str, default=".", help="root directory")
    return parser</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint._check_object_refs" class="doc doc-heading">
            <code class="highlight language-python">_check_object_refs(sections, kind, pattern_def, pattern_ref)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Check for figure and table references within each Markdown file.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def _check_object_refs(sections, kind, pattern_def, pattern_ref):
    """Check for figure and table references within each Markdown file."""
    ok = True
    for path, content in sections.items():
        defined = set(pattern_def.findall(content))
        referenced = set(pattern_def.findall(content))
        ok = _report_diff(f"{path} {kind}", referenced, defined) and ok
    return ok</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint._check_references" class="doc doc-heading">
            <code class="highlight language-python">_check_references(sections, term, regexp, available)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Check all Markdown files for cross-references.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def _check_references(sections, term, regexp, available):
    """Check all Markdown files for cross-references."""
    ok = True
    seen = set()
    for path, content in sections.items():
        found = {k.group(1) for k in regexp.finditer(content)}
        seen |= found
        missing = found - available
        if missing:
            print(f"Missing {term} keys in {path}: {', '.join(sorted(missing))}")
            ok = False

    unused = available - seen
    if unused:
        print(f"Unused {term} keys: {', '.join(sorted(unused))}")
        ok = False

    return ok</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint._is_missing" class="doc doc-heading">
            <code class="highlight language-python">_is_missing(actual, available)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Is a file missing?</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def _is_missing(actual, available):
    """Is a file missing?"""
    return (not actual.exists()) or (
        (actual.suffix in SUFFIXES) and (actual not in available)
    )</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint._is_special_link" class="doc doc-heading">
            <code class="highlight language-python">_is_special_link(link)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Is this link handled specially?</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def _is_special_link(link):
    """Is this link handled specially?"""
    return link.startswith("b:") or link.startswith("g:")</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint._report_diff" class="doc doc-heading">
            <code class="highlight language-python">_report_diff(msg, refs, defs)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Report differences if any.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def _report_diff(msg, refs, defs):
    """Report differences if any."""
    ok = True
    for (kind, vals) in (("missing", refs - defs), ("unused", defs - refs)):
        if vals:
            print(f"{msg} {kind}: {', '.join(vals)}")
            ok = False
    return ok</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mccole.lint._resolve_path" class="doc doc-heading">
            <code class="highlight language-python">_resolve_path(source, dest)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Account for '..' in paths.</p>


            <details class="quote">
              <summary>Source code in <code>mccole/lint.py</code></summary>
              <pre class="highlight"><code class="language-python">def _resolve_path(source, dest):
    """Account for '..' in paths."""
    while dest[:3] == "../":
        source = source.parent
        dest = dest[3:]
    result = Path(source, dest)
    return result</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
